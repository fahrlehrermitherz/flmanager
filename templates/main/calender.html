{% extends 'base.html' %}
{% block title %}Kalender{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-4">ðŸ“… Fahrstunden-Kalender</h1>

<div id="slot-container" class="space-y-2">
    <!-- Slots werden hier dynamisch eingefÃ¼gt -->
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    fetchSlots();

    function fetchSlots() {
        fetch("/calendar/slots")
            .then(response => response.json())
            .then(slots => {
                const container = document.getElementById("slot-container");
                container.innerHTML = ""; // leeren

                if (slots.length === 0) {
                    container.innerHTML = "<p class='text-gray-600'>Keine Slots vorhanden.</p>";
                }

                slots.forEach(slot => {
                    const div = document.createElement("div");
                    div.className = "p-4 bg-white rounded shadow flex justify-between items-center";
                    div.innerHTML = `
                        <div>
                            <strong>${slot.date}</strong> um <strong>${slot.time}</strong> â€“ Status: <em>${slot.status}</em>
                        </div>
                        ${slot.status === "frei" ? `
                        <button class="bg-blue-600 text-white px-3 py-1 rounded book-btn" data-id="${slot.id}">
                            Buchen
                        </button>` : `<span class="text-gray-500">Nicht buchbar</span>`}
                    `;
                    container.appendChild(div);
                });

                document.querySelectorAll(".book-btn").forEach(button => {
                    button.addEventListener("click", function() {
                        const slotId = this.getAttribute("data-id");
                        bookSlot(slotId);
                    });
                });
            });
    }

    function bookSlot(slotId) {
        fetch("/calendar/book", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ slot_id: slotId })
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            fetchSlots(); // Neu laden
        });
    }
});
</script>
{% endblock %}
