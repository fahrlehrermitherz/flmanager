{% extends 'base.html' %}

{% block title %}ğŸ“˜ Kassenbuch{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold mb-6">ğŸ“˜ Kassenbuch â€“ EinnahmenÃ¼bersicht</h1>

<form method="get" class="mb-4 flex flex-wrap items-center gap-3">
    <label for="monat" class="font-medium">Monat:</label>
    <input type="month" id="monat" name="monat" value="{{ request.args.get('monat', '') }}" class="border rounded px-2 py-1">
    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded">Filtern</button>
</form>

<div class="overflow-x-auto">
    <table class="min-w-full bg-white border rounded shadow-md text-sm">
        <thead class="bg-gray-100 text-left">
            <tr>
                <th class="px-4 py-2">ğŸ“… Datum</th>
                <th class="px-4 py-2">â° Uhrzeit</th>
                <th class="px-4 py-2">ğŸ‘¨â€ğŸ« Fahrlehrer</th>
                <th class="px-4 py-2">ğŸ§‘â€ğŸ“ SchÃ¼ler</th>
                <th class="px-4 py-2">ğŸ“‹ Inhalt</th>
                <th class="px-4 py-2">â±ï¸ Dauer</th>
                <th class="px-4 py-2">ğŸ’³ Bezahlung</th>
                <th class="px-4 py-2">ğŸ’¶ Betrag (â‚¬)</th>
            </tr>
        </thead>
        <tbody>
            {% set gesamt = 0 %}
            {% for eintrag in fahrten %}
            {% set betrag = eintrag.dauer_minuten * eintrag.typ.preis_pro_minute %}
            {% set gesamt = gesamt + betrag %}
            <tr class="border-b hover:bg-gray-50">
                <td class="px-4 py-2">{{ eintrag.datum.strftime('%d.%m.%Y') }}</td>
                <td class="px-4 py-2">{{ eintrag.uhrzeit.strftime('%H:%M') }}</td>
                <td class="px-4 py-2">{{ eintrag.fahrlehrer.vorname }} {{ eintrag.fahrlehrer.nachname }}</td>
                <td class="px-4 py-2">{{ eintrag.schueler.vorname }} {{ eintrag.schueler.nachname }}</td>
                <td class="px-4 py-2">{{ eintrag.inhalt }}</td>
                <td class="px-4 py-2">{{ eintrag.dauer_minuten }} Min</td>
                <td class="px-4 py-2">{{ eintrag.bezahlt }}</td>
                <td class="px-4 py-2">{{ betrag|round(2) }}</td>
            </tr>
            {% endfor %}
            <tr class="font-bold bg-gray-100 border-t">
                <td colspan="7" class="px-4 py-2 text-right">ğŸ’° Gesamteinnahmen:</td>
                <td class="px-4 py-2">{{ gesamt|round(2) }} â‚¬</td>
            </tr>
        </tbody>
    </table>
</div>
{% endblock %}
